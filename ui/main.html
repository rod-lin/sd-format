<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Pragma" content="no-cache">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
	
		<link rel="stylesheet" href="/ui/font/fontawesome/import.css">
		<link rel="stylesheet" href="/ui/font/ubuntu/import.css">
		<link rel="stylesheet" href="/ui/font/alegreya/import.css">
		<link rel="stylesheet" href="/ui/css/main.css">

		<script src="/ui/js/jquery.js"></script>
	</head>

	<body>
		<div id="main-stage">
			<div id="main-auth-layer">
				<div class="main-auth-board main-vcenter">
					<div class="main-auth-title">Authorize</div>
					<div id="main-auth-slide-1" class="main-auth-slide">
						<div class="main-auth-slide-cont main-vcenter">
							<span class="fa fa-inbox" style="font-size: 8em;"></span><br>
							<div id="main-auth-prompt">Put the public card<br>on the reader</div>
						</div>
					</div>
					<div id="main-auth-slide-2" class="main-auth-slide">
						<div class="main-auth-slide-cont main-vcenter" style="margin-top: 2em;">
							<input id="main-auth-passwd" class="main-auth-textbox" type="password"><br>
							<div id="main-auth-submit-passwd" class="main-auth-button main-auth-button-green">THAT'S IT</div>
						</div>
					</div>
				</div>
			</div>

			<div id="main-loader-layer">
				<div id="main-loader" class="main-loader main-vcenter">
					<span id="main-loader-icon" class="fa fa-cog fa-spin" style="font-size: 4em;"></span><br>
					<span id="main-loader-title">Please connect the reader to the computer</span>
				</div>
			</div>
		</div>

		<script>
			Array.prototype.choose = function () {
				return this[Math.floor(Math.random() * this.length)];
			};

			(function ($) {
				var color_box = [ "#1ABC9C", "#2ECC71", "#3498DB", "#9B59B6", "#E67E22", "#E74C3C" ];

				function _setVCenter(pr, e) {
					e.css("top", ((pr.height() - e.height()) / 2) + "px");
					return;
				}

				function _updatePos() {
					var e = $(".main-vcenter");
					var i;

					for (i = 0; i < e.length; i++) {
						_setVCenter($(e[i]).parent(), $(e[i]));
					}

					return;
				}

				var cur_slide = 1;

				function _slideAuthTo(n) {
					var e, i = 1;

					while ((e = $("#main-auth-slide-" + i)).length) {
						e.css("left", 100 * (i - n) + "%");
						i++;
					}

					return;
				}

				function _poll(url, suc_cb, interv, method) {
					var handler = setInterval(function () {
						$.ajax({
							url: url,
							method: method || "GET",
							dataType: "json",
							success: function (dat) {
								if (suc_cb(dat)) {
									clearInterval(handler)
								}
							}
						});
					}, interv || 1000);

					return;
				}

				function _hideLoader() {
					$("#main-loader-icon").removeClass("fa-cog");
					$("#main-loader-icon").removeClass("fa-spin");
					$("#main-loader-icon").addClass("fa-check");

					$("#main-loader-title").html("found device");

					setTimeout(function () {
						$("#main-loader-layer").css("top", "-100%");
					}, 1000);

					_slideAuthTo(2);
				}

				function _checkPasswd() {
					var pw = $("#main-auth-passwd").val();

					$.ajax({
						url: "/int/radmin",
						method: "GET",
						dataType: "json",
						data: { pw: pw },
						success: function (dat) {
							if (dat.suc) {
								alert("password true");
							} else {
								alert(dat.msg);
							}
						}
					});

					return;
				}

				window.onload = function () {
					_updatePos();

					// _hideLoader();

					$("#main-auth-submit-passwd").click(_checkPasswd);

					_poll("/int/init", function (dat) {
						if (dat.suc) {
							_hideLoader();
							return true;
						}

						return false;
					});

					// $("#main-loader").css("color", color_box.choose());
				};

				window.onresize = _updatePos;

				$("#main-loader-layer").css("background", color_box.choose());
			})(jQuery)
		</script>
	</body>
</html>
