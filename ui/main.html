<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Pragma" content="no-cache">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
	
		<link rel="stylesheet" href="/ui/font/fontawesome/import.css">
		<link rel="stylesheet" href="/ui/font/ubuntu/import.css">
		<link rel="stylesheet" href="/ui/css/main.css">

		<script src="/ui/js/jquery.js"></script>
	</head>

	<body>
		<div id="main-stage">
			<div id="main-loader-layer">
				<div id="main-loader" class="main-loader main-vcenter">
					<span id="main-loader-icon" class="fa fa-cog fa-spin" style="font-size: 4em;"></span><br>
					<span id="main-loader-title">Please connect the reader to the computer</span>
				</div>
			</div>
		</div>

		<script>
			Array.prototype.choose = function () {
				return this[Math.floor(Math.random() * this.length)];
			};

			(function ($) {
				var color_box = [ "#1ABC9C", "#2ECC71", "#3498DB", "#9B59B6", "#E67E22", "#E74C3C" ];

				function _setVCenter(pr, e) {
					e.css("top", ((pr.height() - e.height()) / 2) + "px");
					return;
				}

				function _updatePos() {
					var e = $(".main-vcenter");
					var i;

					for (i = 0; i < e.length; i++) {
						_setVCenter($(e[i]).parent(), $(e[i]));
					}

					return;
				}

				function _poll(url, suc_cb, interv, method) {
					var handler = setInterval(function () {
						$.ajax({
							url: url,
							method: method || "GET",
							dataType: "JSON",
							success: function (dat) {
								if (suc_cb(dat)) {
									clearInterval(handler)
								}
							}
						});
					}, interv || 1000);

					return;
				}

				window.onload = function () {
					_updatePos();

					_poll("/int/init", function (dat) {
						if (dat.suc) {
							$("#main-loader-icon").removeClass("fa-cog");
							$("#main-loader-icon").removeClass("fa-spin");
							$("#main-loader-icon").addClass("fa-check");

							$("#main-loader-title").html("found device");

							setTimeout(function () {
								$("#main-loader-layer").css("top", "-100%");
							}, 1000);

							return true;
						}

						return false;
					});

					// $("#main-loader").css("color", color_box.choose());
				};

				window.onresize = _updatePos;

				$("#main-loader-layer").css("background", color_box.choose());
			})(jQuery)
		</script>
	</body>
</html>
